<!DOCTYPE html>
<html lang="en">
  <head>
    <title>
  Lost in translation - Remix edition ¬∑ joelazar
</title>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="light dark">


<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self'; img-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/; script-src 'self' 'unsafe-inline' https://www.google-analytics.com https://gc.zgo.at http://gc.zgo.at; prefetch-src 'self'; connect-src 'self' https://www.google-analytics.com;">




<meta name="author" content="J√≥zsef L√°z√°r">
<meta name="description" content="Receive the right data from your server in Remix">
<meta name="keywords" content="blog,developer,personal">

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Lost in translation - Remix edition"/>
<meta name="twitter:description" content="Receive the right data from your server in Remix"/>

<meta property="og:title" content="Lost in translation - Remix edition" />
<meta property="og:description" content="Receive the right data from your server in Remix" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://joelazar.github.io/posts/lost-in-translation/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-08-22T08:00:00+01:00" />
<meta property="article:modified_time" content="2022-08-22T08:00:00+01:00" />




<link rel="canonical" href="https://joelazar.github.io/posts/lost-in-translation/">


<link rel="preload" href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as="font" type="font/woff2" crossorigin>


  
  
  <link rel="stylesheet" href="/css/coder.min.36f76aaf39a14ecf5c3a3c6250dcaf06c238b3d8365d17d646f95cb1874e852b.css" integrity="sha256-NvdqrzmhTs9cOjxiUNyvBsI4s9g2XRfWRvlcsYdOhSs=" crossorigin="anonymous" media="screen" />






  
    
    
    <link rel="stylesheet" href="/css/coder-dark.min.216e36d3eaf6f4cdfd67dc1200c49a8169e6478102977b3e9ac51a064c57054c.css" integrity="sha256-IW420&#43;r29M39Z9wSAMSagWnmR4ECl3s&#43;msUaBkxXBUw=" crossorigin="anonymous" media="screen" />
  



 




<link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16">

<link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
<link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#5bbad5">




<meta name="generator" content="Hugo 0.108.0">





  </head>






<body class="preload-transitions colorscheme-dark">
  
<div class="float-container">
    <a id="dark-mode-toggle" class="colorscheme-toggle">
        <i class="fa fa-adjust fa-fw" aria-hidden="true"></i>
    </a>
</div>


  <main class="wrapper">
    <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="/">
      joelazar
    </a>
    
      <input type="checkbox" id="menu-toggle" />
      <label class="menu-button float-right" for="menu-toggle">
        <i class="fa fa-bars fa-fw" aria-hidden="true"></i>
      </label>
      <ul class="navigation-list">
        
          
            <li class="navigation-item">
              <a class="navigation-link" href="/posts/">Blog</a>
            </li>
          
        
        
      </ul>
    
  </section>
</nav>


    <div class="content">
      
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">
            <a class="title-link" href="https://joelazar.github.io/posts/lost-in-translation/">
              Lost in translation - Remix edition
            </a>
          </h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fa fa-calendar" aria-hidden="true"></i>
              <time datetime="2022-08-22T08:00:00&#43;01:00">
                August 22, 2022
              </time>
            </span>
            <span class="reading-time">
              <i class="fa fa-clock-o" aria-hidden="true"></i>
              5-minute read
            </span>
          </div>
          
          
          <div class="tags">
  <i class="fa fa-tag" aria-hidden="true"></i>
    <span class="tag">
      <a href="/tags/remix/">remix</a>
    </span>
      <span class="separator">‚Ä¢</span>
    <span class="tag">
      <a href="/tags/typescript/">typescript</a>
    </span>
      <span class="separator">‚Ä¢</span>
    <span class="tag">
      <a href="/tags/network/">network</a>
    </span>
      <span class="separator">‚Ä¢</span>
    <span class="tag">
      <a href="/tags/json/">JSON</a>
    </span></div>

        </div>
      </header>

      <div class="post-content">
        
        <p>Last week I made a ‚ö°Ô∏è talk at <a href="https://www.meetup.com/remix-copenhagen/events/285981900/">Remix Copenhagen</a> meetup. I thought I make a short blog post about the content if I already gather the material for it.</p>
<figure class="center-aligned"><img src="/lost-in-translation/lost_in_translation.gif"
         alt="Lost in translation movie"/>
</figure>

<hr>
<h2 id="there-is-a-mistake-in-this-code-can-you-find-it-">
  There is a mistake in this code. Can you find it? üîç
  <a class="heading-link" href="#there-is-a-mistake-in-this-code-can-you-find-it-">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="font-weight:bold">import</span> <span style="font-weight:bold">type</span> { Note } <span style="font-weight:bold">from</span> <span style="font-style:italic">&#39;@prisma/client&#39;</span>;
</span></span><span style="display:flex;"><span><span style="font-weight:bold">import</span> { useCatch, useLoaderData } <span style="font-weight:bold">from</span> <span style="font-style:italic">&#39;@remix-run/react&#39;</span>;
</span></span><span style="display:flex;"><span><span style="font-weight:bold">import</span> <span style="font-weight:bold">type</span> { LoaderFunction } <span style="font-weight:bold">from</span> <span style="font-style:italic">&#39;@remix-run/server-runtime&#39;</span>;
</span></span><span style="display:flex;"><span><span style="font-weight:bold">import</span> { json } <span style="font-weight:bold">from</span> <span style="font-style:italic">&#39;@remix-run/server-runtime&#39;</span>;
</span></span><span style="display:flex;"><span><span style="font-weight:bold">import</span> { prisma } <span style="font-weight:bold">from</span> <span style="font-style:italic">&#39;~/db.server&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-style:italic">/*
</span></span></span><span style="display:flex;"><span><span style="font-style:italic">export type Note = {
</span></span></span><span style="display:flex;"><span><span style="font-style:italic">  id: string
</span></span></span><span style="display:flex;"><span><span style="font-style:italic">  title: string
</span></span></span><span style="display:flex;"><span><span style="font-style:italic">  body: string
</span></span></span><span style="display:flex;"><span><span style="font-style:italic">  createdAt: Date
</span></span></span><span style="display:flex;"><span><span style="font-style:italic">  updatedAt: Date
</span></span></span><span style="display:flex;"><span><span style="font-style:italic">}
</span></span></span><span style="display:flex;"><span><span style="font-style:italic">*/</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">type</span> LoaderData = {
</span></span><span style="display:flex;"><span>  notes: <span style="">Note</span>[];
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">export</span> <span style="font-weight:bold">const</span> loader: <span style="">LoaderFunction</span> = <span style="font-weight:bold">async</span> () =&gt; {
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">const</span> notes = <span style="font-weight:bold">await</span> prisma.note.findMany({});
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">return</span> json({ notes });
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">export</span> <span style="font-weight:bold">default</span> <span style="font-weight:bold">function</span> Problem() {
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">const</span> { notes } = useLoaderData&lt;<span style="font-weight:bold">LoaderData</span>&gt;();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">return</span> (
</span></span><span style="display:flex;"><span>    &lt;&gt;
</span></span><span style="display:flex;"><span>      {notes.map((note) =&gt; (
</span></span><span style="display:flex;"><span>        &lt;<span style="font-weight:bold">div</span>
</span></span><span style="display:flex;"><span>          key={note.id}
</span></span><span style="display:flex;"><span>          className=<span style="font-style:italic">&#34;p flex flex-auto flex-col p-4 sm:p-6 lg:p-8&#34;</span>
</span></span><span style="display:flex;"><span>        &gt;
</span></span><span style="display:flex;"><span>          &lt;<span style="font-weight:bold">h2</span> className=<span style="font-style:italic">&#34;text-2xl font-bold&#34;</span>&gt;{note.title}&lt;/<span style="font-weight:bold">h2</span>&gt;
</span></span><span style="display:flex;"><span>          &lt;<span style="font-weight:bold">ul</span> className=<span style="font-style:italic">&#34;text-lg&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="font-weight:bold">li</span>&gt;
</span></span><span style="display:flex;"><span>              Created at: {Intl.DateTimeFormat(<span style="font-style:italic">&#39;en-US&#39;</span>).format(note.createdAt)}
</span></span><span style="display:flex;"><span>            &lt;/<span style="font-weight:bold">li</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="font-weight:bold">li</span>&gt;
</span></span><span style="display:flex;"><span>              Updated at: {Intl.DateTimeFormat(<span style="font-style:italic">&#39;en-US&#39;</span>).format(note.updatedAt)}
</span></span><span style="display:flex;"><span>            &lt;/<span style="font-weight:bold">li</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="font-weight:bold">li</span>&gt;Body: {note.body}&lt;/<span style="font-weight:bold">li</span>&gt;
</span></span><span style="display:flex;"><span>          &lt;/<span style="font-weight:bold">ul</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;/<span style="font-weight:bold">div</span>&gt;
</span></span><span style="display:flex;"><span>      ))}
</span></span><span style="display:flex;"><span>    &lt;/&gt;
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><hr>
<h2 id="-solution">
  ‚ö†Ô∏è Solution
  <a class="heading-link" href="#-solution">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>The problem is with the following lines:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span>&lt;<span style="font-weight:bold">li</span>&gt;
</span></span><span style="display:flex;"><span>  Created at: {Intl.DateTimeFormat(<span style="font-style:italic">&#34;en-US&#34;</span>).format(note.createdAt)}
</span></span><span style="display:flex;"><span>&lt;/<span style="font-weight:bold">li</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="font-weight:bold">li</span>&gt;
</span></span><span style="display:flex;"><span>  Updated at: {Intl.DateTimeFormat(<span style="font-style:italic">&#34;en-US&#34;</span>).format(note.updatedAt)}
</span></span><span style="display:flex;"><span>&lt;/<span style="font-weight:bold">li</span>&gt;
</span></span></code></pre></div><p>Here, <code>note.createdAt</code> and <code>note.updatedAt</code> will have the type <code>string</code> instead of <code>Date</code>.</p>
<hr>
<h2 id="explanation-">
  Explanation üìú
  <a class="heading-link" href="#explanation-">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<h3 id="at-page-navigation">
  At page navigation
  <a class="heading-link" href="#at-page-navigation">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>The client gets the code-split bundle for that page, and at time <strong>same</strong> time, the loader for that route gets evaluated, which is a <strong>Fetch</strong> request to the server. The response body of that request will be encoded in <code>JSON</code>, so it has to be serializable. Date and some other types don&rsquo;t have a native <code>JSON</code> representation.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
</span></span><span style="display:flex;"><span>‚îÇ     üñ•Ô∏è     ‚óÑ‚îÄ‚îÄ‚îÄcode split bundle‚îÄ‚îÄ‚îÄ‚î§     ‚òÅÔ∏è      ‚îÇ
</span></span><span style="display:flex;"><span>‚îÇ  browser   ‚óÑ‚îÄ‚îÄ‚îÄdata from loader‚îÄ‚îÄ‚îÄ‚îÄ‚î§   server    ‚îÇ
</span></span><span style="display:flex;"><span>‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
</span></span></code></pre></div><p><img src="/lost-in-translation/navigation.png" alt="Navigation"></p>
<h3 id="at-full-reload">
  At full reload
  <a class="heading-link" href="#at-full-reload">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>A full reload on the same route will do a full server render, and the data will be just embedded in the HTML. Loaders will be evaluated on the server side, but the data still has to be serializable there too.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
</span></span><span style="display:flex;"><span>‚îÇ     üñ•Ô∏è     ‚óÑ‚îÄ‚îÄ‚îÄfull code bundle‚îÄ‚îÄ‚îÄ‚îÄ‚î§     ‚òÅÔ∏è      ‚îÇ
</span></span><span style="display:flex;"><span>‚îÇ  browser   ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄprefilled html‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§   server    ‚îÇ
</span></span><span style="display:flex;"><span>‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
</span></span></code></pre></div><p><img src="/lost-in-translation/full_reload.png" alt="Full reload"></p>
<hr>
<h2 id="ok-types">
  OK types
  <a class="heading-link" href="#ok-types">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<ul>
<li>‚úÖ string</li>
<li>‚úÖ number</li>
<li>‚úÖ boolean</li>
<li>‚úÖ null</li>
<li>‚úÖ Array</li>
<li>‚úÖ Object</li>
</ul>
<hr>
<h2 id="problematic-types">
  Problematic types
  <a class="heading-link" href="#problematic-types">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<ul>
<li>‚ùå Date</li>
<li>‚ùå BigInt</li>
<li>‚ùå Set</li>
<li>‚ùå Map</li>
<li>‚ùå RegExp</li>
<li>‚ùå undefined</li>
<li>‚ùå Error</li>
<li>‚ùå NaN</li>
</ul>
<hr>
<h2 id="at-least-we-get-a-linter-warning-since-remix-165">
  At least we get a linter warning since remix 1.6.5
  <a class="heading-link" href="#at-least-we-get-a-linter-warning-since-remix-165">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p><img src="/lost-in-translation/linter_warning.png" alt="Linter warning"></p>
<hr>
<h2 id="how-to-solve-it---stupid-solution">
  How to solve it - stupid solution
  <a class="heading-link" href="#how-to-solve-it---stupid-solution">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>Convert the strings to Dates. For this type, it will work fine, as the <code>Date</code>&rsquo;s constructor accepts strings:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span>&lt;<span style="font-weight:bold">li</span>&gt;
</span></span><span style="display:flex;"><span>  Created at: {Intl.DateTimeFormat(<span style="font-style:italic">&#34;en-US&#34;</span>).format(<span style="font-weight:bold">new</span> Date(note.createdAt))}
</span></span><span style="display:flex;"><span>&lt;/<span style="font-weight:bold">li</span>&gt;
</span></span><span style="display:flex;"><span>&lt;<span style="font-weight:bold">li</span>&gt;
</span></span><span style="display:flex;"><span>  Updated at: {Intl.DateTimeFormat(<span style="font-style:italic">&#34;en-US&#34;</span>).format(<span style="font-weight:bold">new</span> Date(note.updatedAt))}
</span></span><span style="display:flex;"><span>&lt;/<span style="font-weight:bold">li</span>&gt;
</span></span></code></pre></div><p>However, there are types in which this method won&rsquo;t work. We need a more generic solution for this.</p>
<hr>
<h2 id="how-to-solve-it---the-proper-solution">
  How to solve it - the proper solution
  <a class="heading-link" href="#how-to-solve-it---the-proper-solution">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<h3 id="new-features-since-remix-165">
  New features since remix 1.6.5
  <a class="heading-link" href="#new-features-since-remix-165">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>&ldquo;We enhanced the type signatures of loader and useLoaderData to make it possible to infer the data type from the return type of its related server function. To enable this feature, you will need to use the LoaderArgs type from your Remix runtime package instead of typing the function directly:&rdquo;</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="font-weight:bold">import</span> <span style="font-weight:bold">type</span> { LoaderFunction } <span style="font-weight:bold">from</span> <span style="font-style:italic">&#39;@remix-run/[runtime]&#39;</span>;
</span></span><span style="display:flex;"><span><span style="font-style:italic">// --&gt;
</span></span></span><span style="display:flex;"><span><span style="font-style:italic"></span><span style="font-weight:bold">import</span> <span style="font-weight:bold">type</span> { LoaderArgs } <span style="font-weight:bold">from</span> <span style="font-style:italic">&#39;@remix-run/[runtime]&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">export</span> <span style="font-weight:bold">const</span> loader: <span style="">LoaderFunction</span> = <span style="font-weight:bold">async</span> (args) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">return</span> json&lt;<span style="font-weight:bold">LoaderData</span>&gt;(data);
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span><span style="font-style:italic">// --&gt;
</span></span></span><span style="display:flex;"><span><span style="font-style:italic"></span><span style="font-weight:bold">export</span> <span style="font-weight:bold">async</span> <span style="font-weight:bold">function</span> loader(args: <span style="">LoaderArgs</span>) {
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">return</span> json(data);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>&ldquo;Then you can infer the loader data by using typeof loader as the type variable in useLoaderData:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="font-weight:bold">let</span> data = useLoaderData() <span style="font-weight:bold">as</span> LoaderData;
</span></span><span style="display:flex;"><span><span style="font-style:italic">// --&gt;
</span></span></span><span style="display:flex;"><span><span style="font-style:italic"></span><span style="font-weight:bold">let</span> data = useLoaderData&lt;<span style="font-weight:bold">typeof</span> loader&gt;();
</span></span></code></pre></div><p>With this change, you no longer need to manually define a LoaderData type (huge time and typo saver!), and we serialize all values so that useLoaderData can&rsquo;t return types that are impossible over the network, such as Date objects or functions.&rdquo;</p>
<p>Reference: <a href="https://github.com/remix-run/remix/releases/tag/remix%401.6.5">Remix 1.6.5 release note</a></p>
<h3 id="remix-typedjson">
  remix-typedjson
  <a class="heading-link" href="#remix-typedjson">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h3>
<p>Drop in replacement for <code>useLoaderData</code>/<code>json</code> calls &ndash;&gt; it will automatically convert your non-serializable types back and forth.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="font-weight:bold">const</span> loaderData = useLoaderData&lt;<span style="font-weight:bold">typeof</span> loader&gt;();
</span></span><span style="display:flex;"><span><span style="font-style:italic">// --&gt;
</span></span></span><span style="display:flex;"><span><span style="font-style:italic"></span><span style="font-weight:bold">const</span> loaderData = useTypedLoaderData&lt;<span style="font-weight:bold">typeof</span> loader&gt;();
</span></span></code></pre></div><p>and</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="font-weight:bold">return</span> json({...})
</span></span><span style="display:flex;"><span><span style="font-style:italic">// --&gt;
</span></span></span><span style="display:flex;"><span><span style="font-style:italic"></span><span style="font-weight:bold">return</span> typedjson({...})
</span></span></code></pre></div><p>Adding these two together:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="font-weight:bold">import</span> <span style="font-weight:bold">type</span> { LoaderArgs } <span style="font-weight:bold">from</span> <span style="font-style:italic">&#39;@remix-run/server-runtime&#39;</span>;
</span></span><span style="display:flex;"><span><span style="font-weight:bold">import</span> { typedjson, useTypedLoaderData } <span style="font-weight:bold">from</span> <span style="font-style:italic">&#39;remix-typedjson&#39;</span>;
</span></span><span style="display:flex;"><span><span style="font-weight:bold">import</span> { prisma } <span style="font-weight:bold">from</span> <span style="font-style:italic">&#39;~/db.server&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">export</span> <span style="font-weight:bold">const</span> loader = <span style="font-weight:bold">async</span> (_: <span style="">LoaderArgs</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">const</span> notes = <span style="font-weight:bold">await</span> prisma.note.findMany({});
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">return</span> typedjson({ notes });
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">export</span> <span style="font-weight:bold">default</span> <span style="font-weight:bold">function</span> Problem() {
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">const</span> { notes } = useTypedLoaderData&lt;<span style="font-weight:bold">typeof</span> loader&gt;();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">return</span> (
</span></span><span style="display:flex;"><span>    &lt;&gt;
</span></span><span style="display:flex;"><span>      {notes.map((note) =&gt; (
</span></span><span style="display:flex;"><span>        &lt;<span style="font-weight:bold">div</span>
</span></span><span style="display:flex;"><span>          key={note.id}
</span></span><span style="display:flex;"><span>          className=<span style="font-style:italic">&#34;p flex flex-auto flex-col p-4 sm:p-6 lg:p-8&#34;</span>
</span></span><span style="display:flex;"><span>        &gt;
</span></span><span style="display:flex;"><span>          &lt;<span style="font-weight:bold">h2</span> className=<span style="font-style:italic">&#34;text-2xl font-bold &#34;</span>&gt;{note.title}&lt;/<span style="font-weight:bold">h2</span>&gt;
</span></span><span style="display:flex;"><span>          &lt;<span style="font-weight:bold">ul</span> className=<span style="font-style:italic">&#34;text-lg&#34;</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="font-weight:bold">li</span>&gt;
</span></span><span style="display:flex;"><span>              Created at: {Intl.DateTimeFormat(<span style="font-style:italic">&#39;en-US&#39;</span>).format(note.createdAt)}
</span></span><span style="display:flex;"><span>            &lt;/<span style="font-weight:bold">li</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="font-weight:bold">li</span>&gt;
</span></span><span style="display:flex;"><span>              Updated at: {Intl.DateTimeFormat(<span style="font-style:italic">&#39;en-US&#39;</span>).format(note.updatedAt)}
</span></span><span style="display:flex;"><span>            &lt;/<span style="font-weight:bold">li</span>&gt;
</span></span><span style="display:flex;"><span>            &lt;<span style="font-weight:bold">li</span>&gt;Body: {note.body}&lt;/<span style="font-weight:bold">li</span>&gt;
</span></span><span style="display:flex;"><span>          &lt;/<span style="font-weight:bold">ul</span>&gt;
</span></span><span style="display:flex;"><span>        &lt;/<span style="font-weight:bold">div</span>&gt;
</span></span><span style="display:flex;"><span>      ))}
</span></span><span style="display:flex;"><span>    &lt;/&gt;
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This works now as we are sending a <code>__meta__</code> object with the original <code>JSON</code> content, so on the client side the necessary data could be converted to the right type.</p>
<p><img src="/lost-in-translation/remix_typedjson_resp.png" alt="New response"></p>
<hr>
<h2 id="what-about-other-remix-api">
  What about other Remix API?
  <a class="heading-link" href="#what-about-other-remix-api">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>Actions and fetchers are affected as well, but remix-typedjson handles them.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="font-weight:bold">const</span> actionData = useTypedActionData&lt;<span style="font-weight:bold">typeof</span> action&gt;();
</span></span></code></pre></div><p>and</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="font-weight:bold">const</span> fetcher = useTypedFetcher&lt;<span style="font-weight:bold">typeof</span> action&gt;();
</span></span></code></pre></div><hr>
<h2 id="could-it-be-solved-with-superjsonhttpsgithubcomblitz-jssuperjson">
  Could it be solved with <a href="https://github.com/blitz-js/superjson">superjson</a>?
  <a class="heading-link" href="#could-it-be-solved-with-superjsonhttpsgithubcomblitz-jssuperjson">
    <i class="fa fa-link" aria-hidden="true" title="Link to heading"></i>
    <span class="sr-only">Link to heading</span>
  </a>
</h2>
<p>Yes, of course.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-typescript" data-lang="typescript"><span style="display:flex;"><span><span style="font-weight:bold">import</span> { deserialize, serialize } <span style="font-weight:bold">from</span> <span style="font-style:italic">&#34;superjson&#34;</span>;
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span><span style="font-weight:bold">export</span> <span style="font-weight:bold">const</span> loader: <span style="">LoaderFunction</span> = <span style="font-weight:bold">async</span> () =&gt; {
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">const</span> notes = <span style="font-weight:bold">await</span> prisma.note.findMany({});
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">return</span> json(serialize({ notes }));
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="font-weight:bold">export</span> <span style="font-weight:bold">default</span> <span style="font-weight:bold">function</span> Problem() {
</span></span><span style="display:flex;"><span>  <span style="font-weight:bold">const</span> { notes } = deserialize(
</span></span><span style="display:flex;"><span>    useLoaderData() <span style="font-weight:bold">as</span> SuperJSONResult
</span></span><span style="display:flex;"><span>  ) <span style="font-weight:bold">as</span> LoaderData;
</span></span><span style="display:flex;"><span>  ...
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>However, <code>remix-typesjson</code>&rsquo;s API is much more comfortable to use, not to mention that it&rsquo;s faster and more lightweight than superjson.</p>
<hr>
<p><a href="https://github.com/joelazar/lost-in-translation">Link</a> for the presentation and code examples.</p>

      </div>


      <footer>
        


        
        
        
      </footer>
    </article>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css"
    integrity="sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0" crossorigin="anonymous">
  
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js"
    integrity="sha384-PwRUT/YqbnEjkZO0zZxNqcxACrXe+j766U2amXcgMg5457rve2Y7I6ZJSm2A0mS4" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js"
    integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"
    onload="renderMathInElement(document.body,
      {
        delimiters: [
          {left: '$$', right: '$$', display:true},
          {left: '$', right: '$', display:false},
          {left: '\\(', right: '\\)', display: false},
          {left: '\\[', right: '\\]', display: true}
        ]
      }
    );"></script>
  </section>

    </div>

    <footer class="footer">
  <section class="container">
    ¬©
    
      2020 -
    
    2023
     J√≥zsef L√°z√°r 
    ¬∑
    
    Powered by <a href="https://gohugo.io/">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/">Coder</a>.
    
  </section>
</footer>

  </main>

  

  
  
  <script src="/js/coder.min.27afce394fb6284f521b3fbc9f6a8326342333c3092267f3944d770489876fed.js" integrity="sha256-J6/OOU&#43;2KE9SGz&#43;8n2qDJjQjM8MJImfzlE13BImHb&#43;0="></script>
  

  

  


  

  

  

  

  

  

  
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-161763565-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-161763565-1');
</script>


  
</body>

</html>
